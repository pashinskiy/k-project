<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/order.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/order.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from "react"
import { makeStyles, Grid, Typography, Divider } from "@material-ui/core"
import { graphql } from "gatsby"
import {
  GlobalStateContext,
  GlobalDispatchContext,
} from "../context/GlobalContextProvider"
import Seo from "../components/seo"
import OrderConfirmedIcon from "../../static/svg/orderConfirmedIcon.svg"
import HeaderWithIcon from "../components/headers/headerWithIcon"
import OrderCard from "../components/orderPage/orderCard"
import Layout from "../components/layout"

const useStyle = makeStyles(theme => ({
  disclaimer: {
    fontWeight: 300,
    lineHeight: 1.21,
    color: "#838383",

    marginTop: "2.18vw",
    width: "69.53vw",
    fontSize: "1.09vw",
    "@media(min-width: 1280px)": {
      marginTop: "28px",
      width: "890px",
      fontSize: "14px",
    },
    "@media(max-width: 1025px)": {
      marginTop: "3.35vw",
      width: "100%",
      fontSize: "1.67vw",
    },
    "@media(max-width: 767px)": {
      marginTop: "6.76vw",
      fontSize: "2.89vw",
    },

    "&amp; a": {
      fontWeight: 500,
    },
  },
  supportText: {
    marginTop: "1em",
    fontWeight: 500,
    lineHeight: 1.21,
    color: "#838383",
    textDecoration: "none",

    fontSize: "1.09vw",
    "@media(min-width: 1280px)": {
      fontSize: "14px",
    },
    "@media(max-width: 1025px)": {
      fontSize: "1.67vw",
    },
    "@media(max-width: 767px)": {
      fontSize: "2.89vw",
    },
  },
  title: {
    fontSize: "1.875vw",
    lineHeight: "2.2695vw",
    "@media(min-width: 1280px)": {
      fontSize: 24,
      lineHeight: "29.05px",
    },
    "@media(max-width: 1025px)": {
      fontSize: "2.8776vw",
      lineHeight: "3.4832vw",
    },
    "@media(max-width: 767px)": {
      fontSize: "3.38164vw",
      lineHeight: "4.0917vw",
    },
  },
  titleOrderName: {
    color: theme.palette.color.main,
    width: "19.53125vw",
    marginRight: "4.6875vw",
    "@media(min-width: 1280px)": {
      width: "250px",
      marginRight: "60px",
    },
    "@media(max-width: 1025px)": {
      width: "29.976vw",
      marginRight: "7.1942vw",
    },
    "@media(max-width: 767px)": {
      width: "39.85507vw",
      marginRight: "1.93236vw",
    },
  },
  titleOrderValue: {
    color: theme.palette.color.main,
    fontWeight: 700,
    width: "29.2968vw",
    "@media(min-width: 1280px)": {
      width: "375px",
    },
    "@media(max-width: 1025px)": {
      width: "44.964vw",
    },
    "@media(max-width: 767px)": {
      width: "55.314vw",
    },
  },
  orderDataWrapper: {
    display: "flex",
    marginBottom: "1.25vw",
    "@media(min-width: 1280px)": {
      marginBottom: "16px",
    },
    "@media(max-width: 1025px)": {
      marginBottom: "1.9184vw",
    },
    "@media(max-width: 767px)": {
      marginBottom: "3.8647vw",
    },
    "&amp;:nth-last-child(1)": {
      marginBottom: 0,
    },
  },
  orderInfoContainer: {
    width: "62.5vw",
    margin: "2.1875vw 0",
    "@media(min-width: 1280px)": {
      width: "800px",
      margin: "28px 0",
    },
    "@media(max-width: 1025px)": {
      width: "95.9232vw",
      margin: "3.3573vw 0",
    },
    "@media(max-width: 767px)": {
      width: "100%",
      margin: "6.76328vw 0",
    },
  },
  titleAllCost: {
    fontWeight: 700,
    textAlign: "right",

    width: "51.5625vw",
    marginTop: "1.25vw",
    "@media(min-width: 1280px)": {
      width: "660px",
      marginTop: "16px",
    },
    "@media(max-width: 1025px)": {
      width: "79.13669vw",
      marginTop: "1.9184vw",
    },
    "@media(max-width: 767px)": {
      width: "100%",
      marginTop: "1.9323vw",
    },
  },
  productContainer: {
    marginTop: "0.9375vw",
    "@media(min-width: 1280px)": {
      marginTop: "12px",
    },
    "@media(max-width: 1025px)": {
      marginTop: "1.4388vw",
    },
    "@media(max-width: 767px)": {
      marginTop: "2.8985vw",
    },
  },
}))

const IndexPage = ({ data, location }) => {
  const classes = useStyle()

  const error = location.state?.error

  const state = React.useContext(GlobalStateContext)
  const stateDispatch = React.useContext(GlobalDispatchContext)

  const [orderData, setOrderData] = React.useState(null)

  const order_number = error
    ? ""
    : JSON.parse(localStorage.getItem("order_number"))

  const productsInCart = state.allPrismicProduct.edges
    .filter(edge => !!state.inCart(edge.node.id))
    .map(edge => edge.node)
    .map(obj => ({ ...obj, count: state.inCart(obj.id) }))

  // преобразуем цену
  function priceMod(value) {
    let price = value.slice(0, -3)
    let length = price.length
    for (let i = 1; i &lt; length; i++) {
      if (i % 3 === 0) {
        price = price.slice(0, length - i) + " " + price.slice(length - i)
      }
    }
    return price
  }

  React.useEffect(() => {
    if (!error) {
      fetch(`https://admin.krypton.ru/api/order/?id=${order_number}`)
        .then(res => res.json())
        .then(res => {
          setOrderData(res)
        })
    }

    return () => {
      localStorage.removeItem("cart")
      stateDispatch({ type: "CLEAN_CART" })
    }
  }, [])

  const orderInfo = []
  if (orderData !== null)
    orderInfo.push(
      {
        name: "Имя получателя: ",
        value: orderData.customer.name,
      },
      {
        name: "Телефон получателя: ",
        value: orderData.customer.phone,
      },
      {
        name: "Адрес доставки: ",
        value: orderData.customer.address,
      },
      {
        name: "Дата и время доставки: ",
        value: `${orderData.order.delivery_date} с ${orderData.order.delivery_time_from} до ${orderData.order.delivery_time_to}`,
      },
      {
        name: "Статус заказа: ",
        value: orderData.payment.status_comment,
      },
      {
        name: "Способ оплаты: ",
        value: orderData.payment.payment_type,
      }
    )

  if (error) {
    return (
      &lt;Layout>
        &lt;Seo title="Корзина" />
        &lt;Divider />
        &lt;Typography
          className={classes.titleOrderName + " " + classes.title}
          style={{ width: "100%" }}
        >
          {`Заказ не оформлен, код ошибки ${error}`}
        &lt;/Typography>
      &lt;/Layout>
    )
  }

  return orderData !== null ? (
    &lt;Layout>
      &lt;Seo title="Корзина" />
      &lt;HeaderWithIcon
        title={`Заказ №${order_number}`}
        icon={&lt;OrderConfirmedIcon />}
      />
      &lt;Divider />
      &lt;div className={classes.orderInfoContainer}>
        {orderInfo.map(item => (
          &lt;div className={classes.orderDataWrapper}>
            &lt;Typography
              className={classes.titleOrderName + " " + classes.title}
            >
              {item.name}
            &lt;/Typography>
            &lt;Typography
              className={classes.titleOrderValue + " " + classes.title}
            >
              {item.value}
            &lt;/Typography>
          &lt;/div>
        ))}
      &lt;/div>
      &lt;Divider />

      {productsInCart.length ? (
        &lt;Grid container className={classes.productContainer}>
          {productsInCart.map(item => (
            &lt;OrderCard product={item} />
          ))}
        &lt;/Grid>
      ) : (
        &lt;Grid container className={classes.productContainer}>
          {orderData.order.products.map(product => (
            &lt;OrderCard
              product={{
                count: product.quantity,
                data: { name: product.name, price: product.price },
              }}
            />
          ))}
        &lt;/Grid>
      )}

      &lt;Divider />
      &lt;Typography className={classes.titleAllCost + " " + classes.title}>
        Итого: {priceMod(orderData.order.totalSumm)} &amp;#8381;
      &lt;/Typography>

      &lt;div
        className={classes.disclaimer}
        dangerouslySetInnerHTML={{
          __html: data.prismicCartAndOrder.data.disclaimer.text
            .split("\n")
            .join("&lt;br>"),
        }}
      />

      &lt;Typography className={classes.supportText}>
        {data.prismicCartAndOrder.data.title_support}
      &lt;/Typography>
      &lt;a
        href={`tel:${data.prismicCartAndOrder.data.phone_support}`}
        className={classes.supportText}
      >
        {data.prismicCartAndOrder.data.phone_support}
      &lt;/a>
    &lt;/Layout>
  ) : null
}

/**
 * Страница статуса заказа
 * @module src/page/order
 * @param {Object} props - объект свойств компонента React
 * @param {Object} props.data - объект данных полученый из prismic
 * @param {Object} props.location - объект с данными о местоположении
 */
export default IndexPage

export const query = graphql`
  {
    prismicCartAndOrder {
      data {
        title_support
        phone_support
        disclaimer {
          text
        }
      }
    }
  }
`
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-src_clientOnly.html">src/clientOnly</a></li><li><a href="module-src_components_breadCrumbs.html">src/components/breadCrumbs</a></li><li><a href="module-src_components_button_addInCartAndFav.html">src/components/button/addInCartAndFav</a></li><li><a href="module-src_components_button_addInCartAndFav_buttonAddCart.html">src/components/button/addInCartAndFav/buttonAddCart</a></li><li><a href="module-src_components_button_addInCartAndFav_buttonAddFavorites.html">src/components/button/addInCartAndFav/buttonAddFavorites</a></li><li><a href="module-src_components_button_addInCartAndFav_buttonDelete.html">src/components/button/addInCartAndFav/buttonDelete</a></li><li><a href="module-src_components_button_addInCartAndFav_buttonPlusMinus.html">src/components/button/addInCartAndFav/buttonPlusMinus</a></li><li><a href="module-src_components_button_goRegistration.html">src/components/button/goRegistration</a></li><li><a href="module-src_components_button_pay.html">src/components/button/pay</a></li><li><a href="module-src_components_cartPage_cart.html">src/components/cartPage/cart</a></li><li><a href="module-src_components_cartPage_priceBlock.html">src/components/cartPage/priceBlock</a></li><li><a href="module-src_components_catalog_allProductsByCategory.html">src/components/catalog/allProductsByCategory</a></li><li><a href="module-src_components_catalog_blockPrice.html">src/components/catalog/blockPrice</a></li><li><a href="module-src_components_catalog_catalogCardProduct.html">src/components/catalog/catalogCardProduct</a></li><li><a href="module-src_components_catalog_fastLink.html">src/components/catalog/fastLink</a></li><li><a href="module-src_components_catalog_features.html">src/components/catalog/features</a></li><li><a href="module-src_components_catalog_filtersBySticker.html">src/components/catalog/filtersBySticker</a></li><li><a href="module-src_components_catalog_filtersByTag.html">src/components/catalog/filtersByTag</a></li><li><a href="module-src_components_catalog_scrollBar.html">src/components/catalog/scrollBar</a></li><li><a href="module-src_components_discountedProdicts_filterCategory.html">src/components/discountedProdicts/filterCategory</a></li><li><a href="module-src_components_discountedProdicts_filterCategory_filtersBySubcategory.html">src/components/discountedProdicts/filterCategory/filtersBySubcategory</a></li><li><a href="module-src_components_faqPage_context.html">src/components/faqPage/context</a></li><li><a href="module-src_components_faqPage_main.html">src/components/faqPage/main</a></li><li><a href="module-src_components_faqPage_menu.html">src/components/faqPage/menu</a></li><li><a href="module-src_components_faqPage_search.html">src/components/faqPage/search</a></li><li><a href="module-src_components_faqPage_searchPanel.html">src/components/faqPage/searchPanel</a></li><li><a href="module-src_components_faqPage_showComponent.html">src/components/faqPage/showComponent</a></li><li><a href="module-src_components_faqPage_subgroup.html">src/components/faqPage/subgroup</a></li><li><a href="module-src_components_filter.html">src/components/filter</a></li><li><a href="module-src_components_filter_blockBoolean.html">src/components/filter/blockBoolean</a></li><li><a href="module-src_components_filter_blockCheckbox.html">src/components/filter/blockCheckbox</a></li><li><a href="module-src_components_filter_blockColors.html">src/components/filter/blockColors</a></li><li><a href="module-src_components_filter_blockFromTo.html">src/components/filter/blockFromTo</a></li><li><a href="module-src_components_filter_blockMax.html">src/components/filter/blockMax</a></li><li><a href="module-src_components_filter_blockRatio.html">src/components/filter/blockRatio</a></li><li><a href="module-src_components_filter_buttonClean.html">src/components/filter/buttonClean</a></li><li><a href="module-src_components_headers_headersWithIcon.html">src/components/headers/headersWithIcon</a></li><li><a href="module-src_components_layout.html">src/components/layout</a></li><li><a href="module-src_components_layout_catalog.html">src/components/layout/catalog</a></li><li><a href="module-src_components_layout_catalog_category.html">src/components/layout/catalog/category</a></li><li><a href="module-src_components_layout_catalog_mobile.html">src/components/layout/catalog/mobile</a></li><li><a href="module-src_components_layout_footer.html">src/components/layout/footer</a></li><li><a href="module-src_components_layout_footer_link.html">src/components/layout/footer/link</a></li><li><a href="module-src_components_layout_footer_link_default.html">src/components/layout/footer/link/default</a></li><li><a href="module-src_components_layout_footer_productSlider.html">src/components/layout/footer/productSlider</a></li><li><a href="module-src_components_layout_footer_social.html">src/components/layout/footer/social</a></li><li><a href="module-src_components_layout_header.html">src/components/layout/header</a></li><li><a href="module-src_components_layout_header_buttonWithIcon.html">src/components/layout/header/buttonWithIcon</a></li><li><a href="module-src_components_layout_header_catalog.html">src/components/layout/header/catalog</a></li><li><a href="module-src_components_layout_header_link_default.html">src/components/layout/header/link/default</a></li><li><a href="module-src_components_layout_header_link_sale.html">src/components/layout/header/link/sale</a></li><li><a href="module-src_components_layout_header_search.html">src/components/layout/header/search</a></li><li><a href="module-src_components_layout_mobileMenu.html">src/components/layout/mobileMenu</a></li><li><a href="module-src_components_mainPage_advantages.html">src/components/mainPage/advantages</a></li><li><a href="module-src_components_mainPage_categories.html">src/components/mainPage/categories</a></li><li><a href="module-src_components_mainPage_dayProduct.html">src/components/mainPage/dayProduct</a></li><li><a href="module-src_components_mainPage_dayProduct_cardProduct.html">src/components/mainPage/dayProduct/cardProduct</a></li><li><a href="module-src_components_mainPage_hot.html">src/components/mainPage/hot</a></li><li><a href="module-src_components_mainPage_newProducts.html">src/components/mainPage/newProducts</a></li><li><a href="module-src_components_mainPage_news.html">src/components/mainPage/news</a></li><li><a href="module-src_components_mainPage_popular.html">src/components/mainPage/popular</a></li><li><a href="module-src_components_mainPage_sales.html">src/components/mainPage/sales</a></li><li><a href="module-src_components_mainPage_saleValue.html">src/components/mainPage/saleValue</a></li><li><a href="module-src_components_mainPage_social.html">src/components/mainPage/social</a></li><li><a href="module-src_components_mainPageSlider.html">src/components/mainPageSlider</a></li><li><a href="module-src_components_mainPageSlider_advertiseCard.html">src/components/mainPageSlider/advertiseCard</a></li><li><a href="module-src_components_mokkaIframeRegistration.html">src/components/mokkaIframeRegistration</a></li><li><a href="module-src_components_orderingPage_context.html">src/components/orderingPage/context</a></li><li><a href="module-src_components_orderingPage_deliveryData.html">src/components/orderingPage/deliveryData</a></li><li><a href="module-src_components_orderingPage_elementsForms_input.html">src/components/orderingPage/elementsForms/input</a></li><li><a href="module-src_components_orderingPage_elementsForms_listRatioRect.html">src/components/orderingPage/elementsForms/listRatioRect</a></li><li><a href="module-src_components_orderingPage_elementsForms_select.html">src/components/orderingPage/elementsForms/select</a></li><li><a href="module-src_components_orderingPage_elementsForms_selectCity.html">src/components/orderingPage/elementsForms/selectCity</a></li><li><a href="module-src_components_orderingPage_elementsForms_variantDelivery.html">src/components/orderingPage/elementsForms/variantDelivery</a></li><li><a href="module-src_components_orderingPage_elementsForms_wrapperWithTitle.html">src/components/orderingPage/elementsForms/wrapperWithTitle</a></li><li><a href="module-src_components_orderingPage_headerWithIcon.html">src/components/orderingPage/headerWithIcon</a></li><li><a href="module-src_components_orderingPage_payData.html">src/components/orderingPage/payData</a></li><li><a href="module-src_components_orderingPage_priceBlock.html">src/components/orderingPage/priceBlock</a></li><li><a href="module-src_components_orderingPage_recipientData.html">src/components/orderingPage/recipientData</a></li><li><a href="module-src_components_orderingPage_smallHeaderAccentWithIcon.html">src/components/orderingPage/smallHeaderAccentWithIcon</a></li><li><a href="module-src_components_orderingPage_smallHeaderWithIcon.html">src/components/orderingPage/smallHeaderWithIcon</a></li><li><a href="module-src_components_orderPage_orderCard.html">src/components/orderPage/orderCard</a></li><li><a href="module-src_components_pagination.html">src/components/pagination</a></li><li><a href="module-src_components_popularBrand.html">src/components/popularBrand</a></li><li><a href="module-src_components_productAddedCard.html">src/components/productAddedCard</a></li><li><a href="module-src_components_productAddedCard_cardOfferProduct.html">src/components/productAddedCard/cardOfferProduct</a></li><li><a href="module-src_components_productPage_cardProduct.html">src/components/productPage/cardProduct</a></li><li><a href="module-src_components_productPage_cardProduct_blockPrice.html">src/components/productPage/cardProduct/blockPrice</a></li><li><a href="module-src_components_productPage_cardProduct_features.html">src/components/productPage/cardProduct/features</a></li><li><a href="module-src_components_productPage_cardProduct_productSlider.html">src/components/productPage/cardProduct/productSlider</a></li><li><a href="module-src_components_productPage_cardProduct_title.html">src/components/productPage/cardProduct/title</a></li><li><a href="module-src_components_productPage_delivery.html">src/components/productPage/delivery</a></li><li><a href="module-src_components_productPage_delivery_deliveryCard.html">src/components/productPage/delivery/deliveryCard</a></li><li><a href="module-src_components_productPage_gallery.html">src/components/productPage/gallery</a></li><li><a href="module-src_components_productPage_gallery_imagesRow.html">src/components/productPage/gallery/imagesRow</a></li><li><a href="module-src_components_productPage_landing.html">src/components/productPage/landing</a></li><li><a href="module-src_components_productPage_landing_imageAndText.html">src/components/productPage/landing/imageAndText</a></li><li><a href="module-src_components_productPage_landing_oneImage.html">src/components/productPage/landing/oneImage</a></li><li><a href="module-src_components_productPage_landing_onlyText.html">src/components/productPage/landing/onlyText</a></li><li><a href="module-src_components_productPage_landing_twoImages.html">src/components/productPage/landing/twoImages</a></li><li><a href="module-src_components_productPage_similarProducts.html">src/components/productPage/similarProducts</a></li><li><a href="module-src_components_productPage_tabPanel.html">src/components/productPage/tabPanel</a></li><li><a href="module-src_components_productPage_%25D1%2581haracteristics.html">src/components/productPage/сharacteristics</a></li><li><a href="module-src_components_productPage_%25D1%2581haracteristics_%25D1%2581haracteristics.html">src/components/productPage/сharacteristics/сharacteristics</a></li><li><a href="module-src_components_saleCardPanel.html">src/components/saleCardPanel</a></li><li><a href="module-src_components_saleCardPanel_saleCard.html">src/components/saleCardPanel/saleCard</a></li><li><a href="module-src_components_saleCardPanel_saleCardMain.html">src/components/saleCardPanel/saleCardMain</a></li><li><a href="module-src_components_salesTextPanel.html">src/components/salesTextPanel</a></li><li><a href="module-src_components_scrollBar.html">src/components/scrollBar</a></li><li><a href="module-src_components_scrollBar_productsScrollBar.html">src/components/scrollBar/productsScrollBar</a></li><li><a href="module-src_components_scrollBar_productsScrollBar_cardProduct.html">src/components/scrollBar/productsScrollBar/cardProduct</a></li><li><a href="module-src_components_search.html">src/components/search</a></li><li><a href="module-src_components_seo.html">src/components/seo</a></li><li><a href="module-src_components_smallCategoriesPanel.html">src/components/smallCategoriesPanel</a></li><li><a href="module-src_components_sort.html">src/components/sort</a></li><li><a href="module-src_components_widgets_cardWidget.html">src/components/widgets/cardWidget</a></li><li><a href="module-src_components_widgets_storiesPanel.html">src/components/widgets/storiesPanel</a></li><li><a href="module-src_context_GlobalContextProvider.html">src/context/GlobalContextProvider</a></li><li><a href="module-src_page_404.html">src/page/404</a></li><li><a href="module-src_page_cart.html">src/page/cart</a></li><li><a href="module-src_page_discounted-products.html">src/page/discounted-products</a></li><li><a href="module-src_page_documents.html">src/page/documents</a></li><li><a href="module-src_page_faq.html">src/page/faq</a></li><li><a href="module-src_page_favorites.html">src/page/favorites</a></li><li><a href="module-src_page_index.html">src/page/index</a></li><li><a href="module-src_page_order.html">src/page/order</a></li><li><a href="module-src_page_ordering.html">src/page/ordering</a></li><li><a href="module-src_page_products.html">src/page/products</a></li><li><a href="module-src_page_sales.html">src/page/sales</a></li><li><a href="module-src_templates_category.html">src/templates/category</a></li><li><a href="module-src_templates_document.html">src/templates/document</a></li><li><a href="module-src_templates_product.html">src/templates/product</a></li><li><a href="module-src_templates_sale.html">src/templates/sale</a></li><li><a href="module-src_templates_subcategory.html">src/templates/subcategory</a></li><li><a href="module-src_templates_theme.html">src/templates/theme</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Aug 30 2021 17:26:44 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
